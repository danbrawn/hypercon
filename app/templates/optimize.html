{% extends 'base.html' %}
{% block content %}
<h1>Оптимизация на рецепта</h1>

<button id="run" class="btn btn-primary">Стартирай</button>

<div id="result" style="display:none;">
  <h3>Резултат</h3>
  <pre id="text-result"></pre>
  <canvas id="chart" width="600" height="300"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.getElementById('run').addEventListener('click', ()=>{
  fetch('/optimize/run', {method:'POST'})
    .then(r=>r.json())
    .then(showResult);
});

function showResult(res){
  document.getElementById('result').style.display='block';
  // текстов резултат
  let txt = `Best MSE: ${res.best_mse}\n`;
  res.material_ids.forEach((id,i)=>{
    txt += `Material ${id}: ${(res.weights[i]*100).toFixed(2)}%\n`;
  });
  document.getElementById('text-result').textContent = txt;

  // графика
  new Chart(document.getElementById('chart'),{
    type:'line',
    data:{
      labels: res.prop_columns,
      datasets:[
        { label:'Target', data: res.target_profile, borderColor:'red', fill:false },
        { label:'Mixed',  data: res.weights.map((w,i)=>w*res.target_profile[i]), borderColor:'blue', fill:false }
      ]
    }
  });
}
</script>
{% endblock %}
